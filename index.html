<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Palacio Skins Scorecard</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 1rem; max-width: 700px; }
    label, select, input { display: block; margin: 0.5rem 0; }
    .score-options input[type="radio"] { margin-right: 0.3rem; }
    .score-options label { margin: 0.3rem 0; padding: 0.3rem; border: 1px solid #ccc; border-radius: 4px; background: #f3f3f3; cursor: pointer; }
    .score-options input[type="radio"]:checked + label {
      background-color: #cce5ff;
      border-color: #66afe9;
    }
    .hidden { display: none; }
    table { width: 100%; margin-top: 1rem; border-collapse: collapse; }
    th, td { border: 1px solid #ccc; padding: 0.4rem; text-align: center; }
    .admin { background: #f9f9f9; padding: 1rem; margin-top: 1rem; border: 1px solid #ccc; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <h1>Palacio Skins Scorecard</h1>

  <div id="scorecard"></div>

  <form id="scoreForm">
    <label for="player">Player:</label>
    <select id="player" required>
  <option value="">-- Select Player --</option>
  <option>Alex Kim</option>
  <option>Alex Mattfolk</option>
  <option>Beau Schmitt</option>
  <option>Brett Heater</option>
  <option>Buzz Gibbs</option>
  <option>Chris Burman</option>
  <option>Commish</option>
  <option>Craig Sanger</option>
  <option>Curtis Strand</option>
  <option>Dan Gilliam</option>
  <option>Daniel Nunez</option>
  <option>Elijah Peterson</option>
  <option>Eric Ingersoll</option>
  <option>Erik Allison</option>
  <option>Gary Dilworth</option>
  <option>Gavin Lodge</option>
  <option>Jared Sanderson</option>
  <option>Jay Nakamura</option>
  <option>Jeff Jordan</option>
  <option>Jermell Mitchell</option>
  <option>Jim Giubilato</option>
  <option>Jory Adam</option>
  <option>Mark Gresser</option>
  <option>Mike Hurvitz</option>
  <option>Neil Gerber</option>
  <option>Roman Alper</option>
  <option>Ryan Haight</option>
  <option>Sean Edwards</option>
  <option>Steve Bonner</option>
  <option>Steve Jess</option>
  <option>Other</option>
</select>
    <input id="otherPlayer" placeholder="Enter player name" class="hidden" />

    <label for="week">Week Number:</label>
    <input type="number" id="week" min="1" required />

    <button id="startRound" type="button">Start Round</button>
    <div id="holeSection"></div>
  </form>

  <div id="summary"></div>
  <div id="adminTools" class="admin hidden"></div>

  <script>
    const SUPABASE_URL = 'https://htsipaxeqaumxntsrsvx.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh0c2lwYXhlcWF1bXhudHNyc3Z4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTEzMjU1NDQsImV4cCI6MjA2NjkwMTU0NH0.AY4mcj85_xWSz2HI2A16kigH58PqAFoEDqZgULcen88';
    const client = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    const maxHoles = 9;
    let currentHole = 1;
    const scores = {};

    const form = document.getElementById('scoreForm');
    const holeSection = document.getElementById('holeSection');
    const scorecard = document.getElementById('scorecard');
    const summary = document.getElementById('summary');
    const adminPanel = document.getElementById('adminTools');
    const startRoundButton = document.getElementById('startRound');

    document.getElementById('player').addEventListener('change', (e) => {
  document.getElementById('otherPlayer').classList.toggle('hidden', e.target.value !== 'Other');
});

    function renderScorecard() {
  const table = document.createElement('table');
  const headerRow = document.createElement('tr');
  headerRow.innerHTML = '<th>Hole</th>' + Array.from({ length: maxHoles }, (_, i) => `<th>${i + 1}</th>`).join('');
  const scoreRow = document.createElement('tr');
  scoreRow.innerHTML = '<td>Score</td>' + Array.from({ length: maxHoles }, (_, i) => `<td>${scores[i + 1] || '-'}</td>`).join('');
  table.appendChild(headerRow);
  table.appendChild(scoreRow);
  scorecard.innerHTML = '<h3>Your Scorecard</h3>';
  scorecard.appendChild(table);
}

function renderHoleForm() {
      holeSection.innerHTML = '';
      if (currentHole > maxHoles) {
        holeSection.innerHTML = '<p>All holes submitted. <button onclick="location.reload()">Restart</button></p>';
        return;
      }
      const div = document.createElement('div');
      div.innerHTML = `
        <h3>Hole ${currentHole}</h3>
        <div class="score-options">
          <label><input type="radio" name="score" value="1"> Hole-in-One</label>
          <label><input type="radio" name="score" value="2"> Birdie</label>
          <div id="chipInContainer" class="hidden">
            <label><input type="checkbox" id="chipIn"> Chip-in</label>
          </div>
          <label><input type="radio" name="score" value="3+"> Par or Worse</label>
        </div>
        <div id="ctpContainer" class="${currentHole === 9 ? '' : 'hidden'}">
          <label><input type="checkbox" id="ctp"> Closest to the Pin</label>
        </div>
        <button type="button" onclick="handleHoleSubmit()">Submit Hole</button>
      `;
      holeSection.appendChild(div);

      const birdieRadio = div.querySelector('input[value="2"]');
      birdieRadio.addEventListener('change', () => document.getElementById('chipInContainer').classList.remove('hidden'));
      div.querySelectorAll('input[name="score"]').forEach(input => {
        if (input.value !== '2') input.addEventListener('change', () => document.getElementById('chipInContainer').classList.add('hidden'));
      });
    }

    async function handleHoleSubmit() {
  const player = document.getElementById('player').value === 'Other'
    ? document.getElementById('otherPlayer').value.trim()
    : document.getElementById('player').value;
  const week = parseInt(document.getElementById('week').value);
  const scoreInput = holeSection.querySelector('input[name="score"]:checked');
  if (!player || !week || !scoreInput) return alert('Fill in all fields');

  let score = scoreInput.value;
  const chipIn = document.getElementById('chipIn')?.checked;
  if (score === '2' && chipIn) score = '2*';
  const ctp = document.getElementById('ctp')?.checked || false;

  const submission = { player, week_number: week, hole: currentHole, score, ctp };

  try {
    const { error } = await client.from('Submissions').insert([submission]);
    if (error) throw error;
  } catch (err) {
    alert('Error submitting: ' + err.message);
    return;
  }

  scores[currentHole] = score;
  renderScorecard();
  currentHole++;

  renderLiveSummary();
  renderHoleForm();
}

    renderHoleForm();

    startRoundButton.addEventListener('click', () => {
      const player = document.getElementById('player').value;
      const week = document.getElementById('week').value;
      if (!player || !week) return alert('Please select a player and enter a week number first.');
      startRoundButton.classList.add('hidden');
      currentHole = 1;
      for (let i = 1; i <= maxHoles; i++) scores[i] = '-';
      renderScorecard();
      renderHoleForm();
    });

    function renderLiveSummary() {
      const week = parseInt(document.getElementById('week').value);
      if (!week) return;
      client
        .from('Submissions')
        .select('*')
        .eq('week_number', week)
        .then(({ data, error }) => {
          if (error || !data) {
            summary.innerHTML = '<p>Error loading summary</p>';
            return;
          }

          const holeStats = {};
          for (let i = 1; i <= 9; i++) {
            holeStats[i] = { birdies: 0, chipins: 0, aces: 0 };
          }

          data.forEach(({ hole, score }) => {
            if (!holeStats[hole]) return;
            if (score === '1') holeStats[hole].aces++;
            else if (score === '2') holeStats[hole].birdies++;
            else if (score === '2*') holeStats[hole].chipins++;
          });

          let html = '<table><tr><th>Hole</th><th>Birdies</th><th>Chip-ins</th><th>Aces</th></tr>';
          for (let i = 1; i <= 9; i++) {
            const h = holeStats[i];
            html += `<tr><td>${i}</td><td>${h.birdies}</td><td>${h.chipins}</td><td>${h.aces}</td></tr>`;
          }
          html += '</table>';
          summary.innerHTML = html;
        });
    }

    renderLiveSummary();

    
    // Remaining code unchanged...
  </script>
</body>
</html>
